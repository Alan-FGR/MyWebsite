<!-- Hand coded by Alan (https://github.com/Alan-FGR) -->
<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Basic Standard Metadata -->
    <title>Alan's Website</title>
    <meta name="description" property="og:description" content="Coding, hacking, ">
    <meta name="author" content="Alan-FGR">

    <!-- Social Media Rich Indexing -->
    <meta property="og:title" content="Alan's Website">
    <meta property="og:type" content="website">
    <meta property="og:url" content="">
    <meta property="og:image" content="image.png">

    <!-- Webpage Icons -->
    <!-- <link rel="icon" href="/favicon.ico">
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png"> -->

    <!-- Styles -->
    <!-- <link rel="stylesheet" href="css/styles.css?v=1.0"> -->

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Encode+Sans+Condensed&family=Exo&display=swap"
        rel="stylesheet">

    <!-- CSS3 Animations -->
    <link rel="stylesheet" href="style.css">

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"
        referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/1.9.1/showdown.min.js" crossorigin="anonymous"
        referrerpolicy="no-referrer"></script>
    <script>

        const issuesUrl = "https://api.github.com/repos/Alan-FGR/aelum/issues?per_page=100&creator=Alan-FGR";

        var debugPanel;
        var mainPanel;
        var articleTemplate;
        var expandedArticle = undefined;
        var collapsedArticleClipperHeight = undefined;

        function formatIsoDateTime(isoDateTime) {
            new Date(isoDateTime).toLocaleDateString(undefined,
                { year: 'numeric', month: 'long', day: 'numeric' })
        }

        function markdownToHtml(markdown) {
            var converter = new showdown.Converter({
                tables: true,
                strikethrough: true,
                noHeaderId: true,
                simplifiedAutoLink: true,
                excludeTrailingPunctuationFromURLs: true,
                tablesHeaderId: true,
                ghCodeBlocks: true,
                tasklists: true,
                ghMentions: true,
                parseImgDimensions: true
            });
            return (converter.makeHtml(markdown));
        }

        function collapseArticle(articleElement, scrollToTop) {
            if (articleElement === undefined) return;
            articleElement.find(".articleClipper").stop(true)
                .animate({ height: collapsedArticleClipperHeight }, { queue: false, duration: 500 });
            startAutoScroll(articleElement);
            articleElement.find(".arrow").removeClass("arrowUp");
            expandedArticle = undefined;
            if (scrollToTop) {
                $([document.documentElement, document.body]).animate(
                    { scrollTop: articleElement.offset().top - 160 },
                    { queue: false, duration: 400 });
            }
        }

        function expandArticle(articleElement) {
            var content = articleElement.find(".articleContent");
            content.stop(true).animate({ marginTop: 0 }, 1000);
            articleElement.find(".articleClipper")
                .animate({ height: content.outerHeight() }, { queue: false, duration: 500 });
            // todo collapse previous
            articleElement.find(".arrow").addClass("arrowUp");
            expandedArticle = articleElement;
        }

        function toggleArticle(articleElement) {
            if (expandedArticle === articleElement) { // collapsing clicked
                collapseArticle(articleElement, true);
                return;
            }
            if (expandedArticle !== undefined) // collapsing other
                collapseArticle(expandedArticle, false)
            expandArticle(articleElement)
        }

        function startAutoScroll(articleElement) {
            function loopScroll() {
                var content = articleElement.find(".articleContent");
                content
                    .animate({ marginTop: articleElement.find(".articleClipper").height() - content.outerHeight() }, 5000)
                    .animate({ marginTop: 0 }, 2000, loopScroll);
            }
            loopScroll();
        }

        function appendArticleToPage(bodyMarkdown) {
            $("#noJavaScriptNotice").hide(100);
            var newArticleElement = articleTemplate.clone().appendTo($("#contentWrapper"));
            newArticleElement.find(".articleBodyContent").html(markdownToHtml(bodyMarkdown));
            newArticleElement.show(250);
            newArticleElement.find(".expandCollapseButton").click(() => toggleArticle(newArticleElement));
            newArticleElement.find(".articleTitle").click(() => toggleArticle(newArticleElement));
            newArticleElement.articleData = bodyMarkdown; // todo add comment and stuff
            console.log(newArticleElement.articleData);
            startAutoScroll(newArticleElement);
        }

        function displayIssuesList(issuesList) {
            issuesList.forEach(element => {
                appendArticleToPage(element.body)
            });
        }

        function isElementWithinScrollArea() {
            var window = $(window);
            var viewport = {
                top: window.scrollTop(),
                left: window.scrollLeft()
            };
            viewport.right = viewport.left + window.width();
            viewport.bottom = viewport.top + window.height();

            var bounds = this.offset();
            bounds.right = bounds.left + this.outerWidth();
            bounds.bottom = bounds.top + this.outerHeight();

            return (!(viewport.right < bounds.left || viewport.left > bounds.right || viewport.bottom < bounds.top || viewport.top > bounds.bottom));
        };

        $(document).ready(
            function () {

                articleTemplate = $(".articleTemplate");
                mainPanel = $("#mainPanel");
                debugPanel = $("#debugPanel");

                collapsedArticleClipperHeight = articleTemplate.find(".articleClipper").height();

                $(window).resize(function () {
                    if (expandedArticle !== undefined) {
                        expandArticle(expandedArticle); // we refresh the sizing of the element
                    }
                });

                $(window).scroll(function () {
                    if (expandedArticle === undefined) return;
                    if (expandedArticle.loadedComments === undefined) {

                    }
                });

                // const markdownRequest = fetch("https://raw.githubusercontent.com/Alan-FGR/aelum/master/README.md");
                // markdownRequest
                //     .then(responseMarkdown => responseMarkdown.text())
                //     .then(markdown => { appendArticleToPage(markdown) })
                //     .catch(
                //         error => debugPanel.text(error)
                //     );

                // return;
                // setTimeout(function () {
                //     for (let i = 0; i < 10; i++) {

                //         setTimeout(function () {
                //             appendArticleToPage(i);
                //         }, i * 1000);
                //     }

                // }, 2000);


                const request = fetch(issuesUrl);

                request
                    .then(responseJson => responseJson.json()) // tries to fully read json from response
                    .then(jsonData => {
                        debugPanel.text(JSON.stringify(jsonData, null, "  "));
                        displayIssuesList(jsonData);
                    })
                    .catch(error => debugPanel.text(error))
            }
        )

    </script>
</head>

<body>

    <header>
        <div class="headerContent">
            <img class="headerLogo" src="logo.png">
            <h1 class="headerText">Alan's Website</h1>
            <nav class="headerNav">
                <a href="#blog">BLOG</a>
                <a href="#projects">PROJECTS</a>
                <a href="#about">ABOUT</a>
                <a href="#contact">CONTACT</a>
            </nav>
        </div>
    </header>

    <div id="contentWrapper">
        <!-- This is the article template object we use to populate with actual data -->
        <article class="articleTemplate" style="display: none;">
            <section class="articleSection">
                <div class="articleHeader">
                    <div class="articleHeaderTopLine">
                        <h2 class="articleTitle">Article Title</h2>
                        <h3 class="articleCommentCount">Comment Count</h3>
                    </div>
                    <div class="articleHeaderBottomLine">
                        <span class="articleAuthor">Article Author</span>
                        <span class="articleDateTime">December 25, 1995b</span>
                    </div>
                </div>
                <div class="articleClipper" style="height: 16em;">
                    <div class="articleContent">
                        <div class="articleBodyContent"></div>
                        <div class="articleComments">
                            <div class="commentsWrapper">
                                <div class="commentTemplate">
                                    <div class="commentHeader">
                                        <div class="commenterName">Commenter Name</div>
                                        <div class="commentDateTime">Dec 29, 1995</div>
                                    </div>
                                    <div class="commentBody">
                                        Comment Body
                                    </div>
                                </div>
                            </div>
                            <div class="spinner commentsLoadingSpinner" style="display: none;"></div>
                        </div>
                    </div>
                </div>
                <div class="articleExpander">
                    <a class="expandCollapseButton">
                        <div class="arrow"></div>
                    </a>
                </div>
            </section>
        </article>
        <!-- End of article template object -->

    </div>

    <!-- Loading spinner always on bottom unless there's nothing to load -->
    <div id="articleLoader">
        <div id="articleLoadingSpinner" class="spinner"></div>
        <span id="noJavaScriptNotice">JavaScript Required!<br />(and a modern browser)</span>
    </div>

    <pre id="mainPanel">Loading JavaScript...</pre>
    <pre id="debugPanel">Loading JavaScript...</pre>

    <footer>

    </footer>

    <!-- <script src="js/scripts.js"></script> -->
</body>

</html>